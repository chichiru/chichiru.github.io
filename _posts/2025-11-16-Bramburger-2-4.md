---
title: 2.4 Approximating the Koopman Operator
description: ""
author: Chiwon_Seo
# date: 2025-07-19 07:00:00 +0800 # 작성 날짜 (파일 명으로 대체)
categories: [Data-Driven, Data-Driven Methods]
tags: [Koopman Operator, Data-Driven Methods]
pin: true
published: true
math: true
mermaid: true
---

### 1. Observable

아래의 Discrete Dynamic System에 대하여 생각해보자

$$
\begin{equation}
X_{n+1} = F(X_{n})
\end{equation}
$$

Flow map이라 불리는 $F$는 특정 시점과 다음 시점의 상태를 연결하는 함수로, $F:\mathcal{M}\rightarrow\mathcal{M}$ 이고 $\mathcal{M}\in \mathbb{R}^{M}$ 이다. ($M$은 State의 개수)

Observable은 상태 공간에 대한 스칼라 함수이다 ($\phi:\mathcal{M}\rightarrow\mathbb{C}$).
Observable은 상태 $X$에 대해 다음을 만족한다.

$$
\begin{equation}
\phi(X_{n+1})=\phi(F(X_{n})) \quad \forall n=1,\ldots,N
\end{equation}
$$

즉 Observable은 Flow map $F$와 Observable 함수 $\phi$의 합성인 $\phi \circ F$을 통해, 상태의 시간 진화가 관측 공간에서 어떻게 나타나는지를 표현한다.

또한 Observable 함수는 선형 특성을 만족한다.

$$
\begin{equation}
(\alpha \phi + \beta\psi)\circ F=\alpha \phi \circ F + \beta\psi\circ F, \quad \forall \alpha, \beta \in \mathbb{C}
\end{equation}
$$

따라서 아무리 복잡한 관측이라도 기저(base) 관측의 선형 조합으로 표현될 수 있는 가능성이 있다.

---
### 2. Koopman Operator
Koopman Operator는 비선형 동적 시스템의 상태 진화를 관측 공간에서 선형 연산으로 표현하는 선형 연산자이다. 즉, 상태 $X_n$의 다음 시점 $X_{n+1}$에 대한 관측 $\phi(X_{n+1})$는 Koopman Operator를 통해 다음과 같이 표현된다.

$$
\begin{equation}
\mathcal{K}\phi = \phi \circ F
\end{equation}
$$

Koopman Operator는 선형 연산자로, 비선형 동적 시스템을 표현하기 위해 무한한 차원의 선형 공간에서 작용한다. 즉, 모든 가능한 관측 함수들의 집합에서 작용하며, 이 집합은 무한 차원일 수 있다.

Koopman Operator $\mathcal{K}$의 선형 특성으로 인해, 무한한 고유값과 고유함수를 가질 수 있다. 즉, 다음을 만족하는 고유함수 $\phi_\alpha$와 고유값 $\mu_\alpha$가 존재한다. 즉 임의의 'state-space observable' $g_m(x)$에 대해 다음이 성립한다.

$$
\begin{equation}
g_m(x) = \sum_{\alpha\in A}c_{m,\alpha}\phi_\alpha(x), \quad c_{m,\alpha}\in \mathbb{C}
\end{equation}
$$

또한 고유함수의 특성인 $\mathcal{K}\phi_\alpha = \mu_\alpha \phi_\alpha$를 이용하면, 비선형 함수 $g_m \circ F$는 다음과 같이 표현될 수 있다.

$$
\begin{equation}
(g_m \circ F) (x) = \mathcal{K} g_m (x) = \sum_{\alpha\in A}\mu_\alpha c_{m,\alpha}\phi_\alpha(x)
\end{equation}
$$

위 식에서 $c_{m,\alpha}$는 Koopman mode라 불리며, 각 고유함수 $\phi_\alpha$가 관측 함수 $g_m$에 기여하는 정도를 나타낸다.

---
### 3. Simple Example of Koopman Operator
아래의 2차원 비선형 동적 시스템을 고려해보자.

$$
\begin{equation}
\begin{bmatrix}
x_1 \\ x_2
\end{bmatrix}_{n+1} =
\begin{bmatrix}
\lambda_{1}x_1 \\  \lambda_{2}(x_{2}-x_1^2)
\end{bmatrix}_{n}
\end{equation}
$$

위 비선형 시스템은 다음과 같은 3차원 선형 시스템으로 확장될 수 있다.

$$
\begin{equation}
\begin{bmatrix}
y_1 \\ y_2 \\ y_3
\end{bmatrix}_{n+1} =
\begin{bmatrix}
\lambda_{1} & 0 & 0 \\
0 & \lambda_{2} & -\lambda_{2} \\
0 & 0 & \lambda_{1}^2
\end{bmatrix}
\begin{bmatrix}
y_1 \\ y_2 \\ y_3
\end{bmatrix}_{n}
\end{equation}
$$

여기서 $y_1 = x_1$, $y_2 = x_2$, $y_3 = x_1^2$이다. 위 선형 시스템은 관측치 $\{x_1, x_2, x_1^2\}$가 생성하는 선형 불변 부분공간에 제한된 Koopman Operator의 표현이다.

또한 Left Eigenvector를 이용해 또다른 형태의 관측치 표현도 가능하다. 식 (8)의 행렬은 다음과 같은 Left Eigenvector를 가진다.

$$
\begin{equation}
w_1 = [1, 0, 0], \quad w_2 = [0, 1, \frac{-\lambda_{2}}{\lambda_{2}-\lambda_{1}^2}], \quad w_3 = [0, 0, 1]
\end{equation}
$$

이를 이용해 3개의 고유함수(Eigenfunction)를 다음과 같이 정의할 수 있다.

$$
\begin{equation}
\phi_1(x_1,x_2) = x_1, \quad \phi_2(x_1,x_2) = x_2 - \frac{\lambda_{2}}{\lambda_{2}-\lambda_{1}^2}x_1^2, \quad \phi_3(x_1,x_2) = x_1^2
\end{equation}
$$

위 고유함수들은 각각의 고유값에 대응하며, 다음과 같은 성질을 가진다.

$$
\begin{equation}
\begin{bmatrix}
\phi_1 \\ \phi_2 \\ \phi_3
\end{bmatrix}_{n+1} =
\begin{bmatrix}
\lambda_{1} & 0 & 0 \\
0 & \lambda_{2} & 0 \\
0 & 0 & \lambda_{1}^2
\end{bmatrix}
\begin{bmatrix}
\phi_1 \\ \phi_2 \\ \phi_3
\end{bmatrix}
\end{equation}
$$

식 (8)과 식 (11)에 나타나는 행렬의 고유값은 동일하다.

---
### 4. Extended Dynamic Mode Decomposition (EDMD)
앞선 예제에도 불구하고, 실제 비선형 시스템을 Koopman Operator로 정확히 표현하는 것은 어렵다. 특정 시스템을 유한한 Koopman Operator로 표현하는 것은 불가능한 경우도 있다. 따라서 실제 시스템에 대해 Koopman Operator를 근사하는 방법이 필요하다. Extended Dynamic Mode Decomposition (EDMD)는 데이터 기반으로 Koopman Operator를 근사하는 방법 중 하나이다. EDMD는 다음과 같은 절차로 진행된다.

먼저 특정 관측치를 정의하자.
$$
\begin{equation}
\mathcal{D} = \{\psi_1, \psi_2, \ldots, \psi_N\}, \quad \psi_i:\mathcal{M}\rightarrow\mathbb{C}
\end{equation}
$$

EDMD의 목적은 관측치 집합 $\mathcal{D}$에 대해 Koopman Operator의 유한 차원 근사를 구하는 것이다. DMD와 마찬가지로 관측치에 대하여 다음과 같은 데이터 행렬을 구성한다.

$$
\begin{equation}
\Psi(X) =
\begin{bmatrix}
\psi_1(X_1) & \psi_1(X_2) & \ldots & \psi_1(X_M) \\
\psi_2(X_1) & \psi_2(X_2) & \ldots & \psi_2(X_M) \\
\vdots & \vdots & \ddots & \vdots \\
\psi_N(X_1) & \psi_N(X_2) & \ldots & \psi_N(X_M) \\
\end{bmatrix}
\end{equation}
$$

$$
\begin{equation}
\Psi(Y) =
\begin{bmatrix}
\psi_1(Y_1) & \psi_1(Y_2) & \ldots & \psi_1(Y_M) \\
\psi_2(Y_1) & \psi_2(Y_2) & \ldots & \psi_2(Y_M) \\
\vdots & \vdots & \ddots & \vdots \\
\psi_N(Y_1) & \psi_N(Y_2) & \ldots & \psi_N(Y_M) \\
\end{bmatrix}
\end{equation}
$$

여기서 $Y_i = X_{i+1} = F(X_i)$이다. EDMD는 다음을 최소화하는 문제를 푼다.

$$
\begin{equation}
\min_{K}\|\Psi(Y) - A \Psi(X)\|_{F}^2
\end{equation}
$$

DMD와 마찬가지로, $K$가 커질수록 비선형 시스템에 대한 근사가 좋아지지만, 계산 비용이 증가한다. DMD 행렬 $A$는 다음과 같이 구할 수 있다.

$$
\begin{equation}
A = \Psi(Y)\Psi(X)^{\dagger}
\end{equation}
$$

앞선 예제와 마찬가지로, EDMD 행렬 $A$의 고유값과 고유벡터를 구하여 Koopman Operator의 근사 고유값과 고유함수를 얻을 수 있다. 즉, $A$의 고유값 $\mu_j$와 좌고유벡터 $w_j$에 대해 Koopman Eigenfunction은 아래와 같이 구할 수 있다. (식 (10) 참고)

$$
\begin{equation}
w_1\psi_1(x) + w_2\psi_2(x) + \ldots + w_K\psi_K(x)
\end{equation}
$$

위 내용을 기반으로 EDMD 알고리즘은 다음과 같이 요약될 수 있다.


#### Algorithm: Extended Dynamic Mode Decomposition (EDMD)
1. For each snapshot $X_n$, gather the subsequent snapshot $Y_n = F(X_n)$.
2. Define a dictionary of observable functions $\mathcal{D} = \{\psi_1, \psi_2, \ldots, \psi_N\}$ and construct the data matrices $\Psi(X)$ and $\Psi(Y)$.
3. Compute the DMD matrix $A = \Psi(Y)\Psi(X)^{\dagger}$.
4. Use left eigenvectors of $A$ to approximate the Koopman eigenfunctions as $w_1\psi_1(x) + w_2\psi_2(x) + \ldots + w_K\psi_K(x)$ with corresponding eigenvalues $\mu$.

---
### 5. Simple Example of EDMD

식 (7)에서 다룬 비선형 시스템에 대해 EDMD를 적용해보자. $lambda_1 = 1.5$, $lambda_2 = 0.5$로 설정하고, 초기 상태 $X_0 = [-1, 1]^T$에서 시작하여 10000개의 스냅샷을 생성한다. 또한 다항식 함수를 사용하여 5개의 관측치를 다음과 같이 정의한다.

$$
\begin{equation}
\mathcal{D} = \{x_1, x_2, x_1^2, x_1x_2, x_2^2\}
\end{equation}
$$

``` matlab
lam1 = 1.5;
lam2 = 0.5;

N = 10000; % numer of snapshots
X = 2*rand(2,N) - 1;
Y = zeros(2,N);

% Populate Y matrix
for n = 1:N
    Y(1,n) = lam1*X(1,n);
    Y(2,n) = lam2*(X(2,n) - X(1,n)^2);
end

%% Create matrices of observables Psi(X) and Psi(Y)
% Start with observable functions of monomials up to degree 2

% First two rows are degree 1 variables (x_1 and x_2)
PsiX = X;
PsiY = Y;

% x_1^2 observable 
PsiX(3,:) = X(1,:).^2; 
PsiY(3,:) = Y(1,:).^2; 

% x_1*x_2 observable 
PsiX(4,:) = X(1,:).*X(2,:); 
PsiY(4,:) = Y(1,:).*Y(2,:); 

% x_2^2 observable 
PsiX(5,:) = X(2,:).^2; 
PsiY(5,:) = Y(2,:).^2;
```

``` matlab
%% DMD matrix
A = PsiY*pinv(PsiX);
[V, D, W] = eig(A); % compute eigenvalues + left (W) & right (V) eigenvectors
mu = diag(D); % extract eigenvalues
```

```matlab
% Print approximate eigenfunctions
for p = 1:5
   fprintf('Eigenvalue: %4.4f \n',mu(p))
   fprintf('Associated (approximate) Koopman eigenfunction:\n')
   fprintf('%4.4f*x1 + %4.4f*x2 + %4.4f*x1^2 + %4.4f*x1*x2 + %4.4f*x2^2\n', W(:,p))
   fprintf('\n')
end
```

위 코드를 실행할 경우 5개의 근사된 Koopman 고유함수와 고유값이 출력된다. 이 중 3개의 고유함수는 실제 시스템의 고유함수와 유사한 형태를 가진다. 나머지 2개의 고유함수는 관측치 집합에 포함된 다항식 항들로 인해 발생한 추가적인 근사 고유함수이다. (설명 보충 필요)

### 6. References
[1] Williams, M. O., Kevrekidis, I. G., & Rowley, C. W. (2015). A data–driven approximation of the koopman operator: Extending dynamic mode decomposition. Journal of Nonlinear Science, 25(6), 1307-1346.

[2] Bramburger, J. J. (2024). Data-driven methods for dynamic systems. Society for Industrial and Applied Mathematics.


